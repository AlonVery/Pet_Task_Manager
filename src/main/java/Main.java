import application.usecase.registration.UserRegistrationUseCase;import com.sun.net.httpserver.HttpServer;import domain.repository.PasswordEncoder;import domain.repository.UserRepository;import infra.db.in_memory_repository.InMemoryUserRepository;import infra.security.PasswordEncoderSha256;import web.controller.controllers.RegistrationUserController;import java.io.IOException;import java.io.InputStream;import java.net.InetSocketAddress;import java.nio.charset.StandardCharsets;public class Main {    public static void main(String[] args) throws IOException {        final UserRepository userRepository = new InMemoryUserRepository();        final PasswordEncoder encoder = new PasswordEncoderSha256();        UserRegistrationUseCase userRegistration = new UserRegistrationUseCase(userRepository, encoder);        HttpServer server = HttpServer.create(new InetSocketAddress(8080), 0);        server.createContext("/users/registration", exchange -> {            if ("POST".equals(exchange.getRequestMethod())) {                try {                    // читаем тело запроса один раз                    String requestBody = new String(exchange.getRequestBody().readAllBytes(), StandardCharsets.UTF_8);                    // вызываем контроллер                    String responseBody = new RegistrationUserController(userRegistration).handle(requestBody);                    // отправляем ответ                    exchange.getResponseHeaders().add("Content-Type", "application/json");                    byte[] responseBytes = responseBody.getBytes(StandardCharsets.UTF_8);                    exchange.sendResponseHeaders(201, responseBytes.length);                    exchange.getResponseBody().write(responseBytes);                } catch (Exception e) {                    String error = "{\"error\":\"" + e.getMessage() + "\"}";                    exchange.getResponseHeaders().add("Content-Type", "application/json");                    byte[] errorBytes = error.getBytes(StandardCharsets.UTF_8);                    exchange.sendResponseHeaders(500, errorBytes.length);                    exchange.getResponseBody().write(errorBytes);                } finally {                    exchange.getResponseBody().close(); // закрываем поток в любом случае                }            }        });        server.start();        System.out.println("Server started at http://localhost:8080");    }}